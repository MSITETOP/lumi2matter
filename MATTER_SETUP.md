# Lumi Matter Bridge - Setup Guide

## –ß—Ç–æ —ç—Ç–æ?

–≠—Ç–æ Matter Bridge –¥–ª—è Xiaomi Lumi Gateway, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–∞—à —à–ª—é–∑ –∫ –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª Matter.

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

- ‚úÖ RGB LED –ø–æ–¥—Å–≤–µ—Ç–∫–∞ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–º, —è—Ä–∫–æ—Å—Ç—å—é)
- ‚úÖ –ö–Ω–æ–ø–∫–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏ (single, double, triple, hold, release)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip3 install -r requirements.txt
```

–ò–ª–∏ –Ω–∞ OpenWrt:

```bash
opkg update
opkg install python3-pip python3-asyncio python3-evdev
pip3 install zeroconf qrcode colorama cryptography
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `lumimqtt.json` –≤ `/etc/lumimqtt.json` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```json
{
  "device_id": "lumi_gateway_001",
  "device_name": "Lumi Gateway",
  
  "matter": {
    "vendor_id": 65521,
    "product_id": 32769,
    "discriminator": 3840,
    "passcode": 20202021
  },
  
  "binary_sensors": {},
  "custom_commands": {}
}
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Matter Bridge

```bash
# –° –∫–æ–Ω—Ñ–∏–≥–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (/etc/lumimqtt.json)
python3 -m lumimqtt

# –ò–ª–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥–æ–º
LUMIMQTT_CONFIG=./lumimqtt.json python3 -m lumimqtt
```

## –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
============================================================
üîó MATTER DEVICE PAIRING INFORMATION
============================================================
Device Name: Lumi Gateway
Device ID: lumi_gateway_001
Vendor ID: 0xFFF1
Product ID: 0x8001
------------------------------------------------------------
üì± Manual Pairing Code: 38400-2020202
üî¢ Discriminator: 3840
üîê Setup PIN: 20202021
------------------------------------------------------------
üì∑ QR Code - scan with Yandex Station:

[ASCII QR –ö–û–î]

============================================================
‚ÑπÔ∏è  Instructions:
1. Open Yandex Station app
2. Go to 'Add Device' -> 'Matter'
3. Scan QR code above OR enter manual code
4. Follow on-screen instructions
============================================================
```

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏–∏

### –°–ø–æ—Å–æ–± 1: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å (—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏–µ–π)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" ‚Üí "–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Matter —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
4. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫–æ–¥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" ‚Üí "–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Matter —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" ‚Üí "–í–≤–µ—Å—Ç–∏ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é"
4. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `38400-2020202`)

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

- **RGB –õ–∞–º–ø–∞** - –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å:
  - –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
  - –Ø—Ä–∫–æ—Å—Ç—å (0-100%)
  - –¶–≤–µ—Ç (RGB)
  - –ì–æ–≤–æ—Ä–∏—Ç—å: "–ê–ª–∏—Å–∞, –≤–∫–ª—é—á–∏ —Å–≤–µ—Ç", "–ê–ª–∏—Å–∞, —Å–¥–µ–ª–∞–π —Å–≤–µ—Ç –∫—Ä–∞—Å–Ω—ã–º"

- **–ö–Ω–æ–ø–∫–∞** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è:
  - –û–¥–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ
  - –î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ
  - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –Ø–Ω–¥–µ–∫—Å

## –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ OpenWrt

–°–æ–∑–¥–∞–π—Ç–µ init —Å–∫—Ä–∏–ø—Ç `/etc/init.d/lumimatter`:

```bash
#!/bin/sh /etc/rc.common

START=99
STOP=10

USE_PROCD=1
PROG=/usr/bin/python3

start_service() {
    procd_open_instance
    procd_set_param command $PROG -m lumimqtt
    procd_set_param env LUMIMQTT_CONFIG=/etc/lumimqtt.json
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
}
```

–í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫:

```bash
chmod +x /etc/init.d/lumimatter
/etc/init.d/lumimatter enable
/etc/init.d/lumimatter start
```

## –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
# –í __main__.py –∏–∑–º–µ–Ω–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.DEBUG)
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Matter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç mDNS –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏—è –∏ —à–ª—é–∑ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏
- –ü–æ—Ä—Ç 5540/UDP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è Matter –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–ø—Ä—è–∂–µ–Ω–∏—è QR –∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —É–∂–µ –≤ —Å–µ—Ç–∏ Matter)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: Matter 1.0+
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: UDP/IP (–ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å)
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: mDNS (Bonjour/Avahi)
- **–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ RGB LED**: Extended Color Light (0x010D)
- **–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∫–Ω–æ–ø–∫–∏**: Generic Switch (0x000F)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (LED, –∫–Ω–æ–ø–∫–∞) –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `journalctl -u lumimatter -f`
